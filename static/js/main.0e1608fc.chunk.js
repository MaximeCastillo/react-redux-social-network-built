(this.webpackJsonpj27_social=this.webpackJsonpj27_social||[]).push([[0],{54:function(t,e,n){},59:function(t,e,n){},60:function(t,e,n){"use strict";n.r(e);var c=n(1),r=n(0),o=n.n(r),s=n(18),a=n.n(s),i=n(6),u=n(20),j=n(39),h=n(7),l="REGISTER_SUCCESS",d="REGISTER_FAILED",p="LOAD_ACCOUNT",b="LOGOUT_SUCCESS",f=n(16),O=n.n(f),m={token:null,isAuthenticated:null,user:null},x=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case p:return Object(h.a)(Object(h.a)({},t),{},{token:e.token,isAuthenticated:!0,user:e.user});case l:return O.a.set("token",e.token,{expires:7}),Object(h.a)(Object(h.a)(Object(h.a)({},t),e.token),{},{token:e.token,isAuthenticated:!0,user:e.user});case d:case b:return O.a.remove("token"),Object(h.a)(Object(h.a)({},t),{},{token:null,user:null,isAuthenticated:!1});default:return t}},v="NEW_POST",y="DELETE_POST",k="EDIT_POST",g="LOAD_POSTS",S="LOAD_POSTS_COUNT",E={posts:[]},N=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case v:return Object(h.a)(Object(h.a)({},t),{},{posts:t.posts.concat(e.newPost)});case y:return Object(h.a)(Object(h.a)({},t),{},{posts:t.posts.filter((function(t){return t.id!==e.toDeletePost.id}))});case k:return Object(h.a)(Object(h.a)({},t),{},{posts:t.posts.map((function(t){return t.id===e.toEditPost.id?e.toEditPost:t}))});case g:return Object(h.a)(Object(h.a)({},t),{},{posts:t.posts.concat(e.posts)});case S:return Object(h.a)(Object(h.a)({},t),{},{postsCount:e.postsCount});default:return t}},w=Object(u.c)({authentification:x,posts:N}),T=Object(u.e)(w,Object(u.d)(Object(u.a)(j.a),window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__())),C=n(40),_=n(8),A=n(15),D=function(t){return{type:l,token:t.jwt,user:t.user}},B=function(){return{type:d}},P=n(64),z=n(66),q=(n(54),function(){var t=Object(i.c)((function(t){return t.authentification.isAuthenticated})),e=Object(_.g)(),n=Object(i.b)(),r=function(){n({type:b}),e.push("/")};return t?Object(c.jsxs)(P.a,{bg:"dark",variant:"dark",children:[Object(c.jsx)(P.a.Brand,{href:"/",children:"My Social Network"}),Object(c.jsxs)(z.a,{className:"mr-auto",children:[Object(c.jsx)(z.a,{className:"nav-item",children:Object(c.jsx)(A.b,{to:"/",children:"Accueil"})}),Object(c.jsx)(z.a,{className:"nav-item",children:Object(c.jsx)(A.b,{to:"/profile",children:"Profil"})}),Object(c.jsx)(z.a,{className:"nav-item",children:Object(c.jsx)("button",{onClick:r,children:"Se d\xe9connecter"})})]})]}):Object(c.jsxs)(P.a,{bg:"dark",variant:"dark",children:[Object(c.jsx)(P.a.Brand,{href:"/",children:"My Social Network"}),Object(c.jsxs)(z.a,{className:"mr-auto",children:[Object(c.jsx)(z.a,{className:"nav-item",children:Object(c.jsx)(A.b,{to:"/",children:"Accueil"})}),Object(c.jsx)(z.a,{className:"nav-item",children:Object(c.jsx)(A.b,{to:"/login",children:"Se connecter"})}),Object(c.jsx)(z.a,{className:"nav-item",children:Object(c.jsx)(A.b,{to:"/register",children:"Cr\xe9\xe9r un compte"})})]})]})}),I=n(9),M=n(65),L=n(62),R=function(){var t=Object(i.c)((function(t){return t.authentification.isAuthenticated})),e=Object(i.c)((function(t){return t.authentification.user})),n=Object(i.c)((function(t){return t.authentification.token})),o=Object(r.useState)(""),s=Object(I.a)(o,2),a=s[0],u=s[1],j=Object(i.b)();return Object(c.jsx)("div",{children:t&&Object(c.jsxs)("section",{children:[Object(c.jsxs)("h5",{children:["Salut ",e.username,", tu peux ajouter ton post ici :"]}),Object(c.jsxs)(M.a,{onSubmit:function(t){t.preventDefault();var c={user:e.id,text:a};fetch("https://my-pasteque-space.herokuapp.com/posts",{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(c)}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){j({type:v,newPost:t}),u("")})).catch((function(t){alert(t)}))},children:[Object(c.jsx)(M.a.Group,{controlId:"Textarea",children:Object(c.jsx)(M.a.Control,{as:"textarea",rows:7,onChange:function(t){return u(t.target.value)},value:a})}),Object(c.jsx)(L.a,{type:"submit",children:"Valider"})]})]})})},F=n(67),J=function(t){var e=t.post,n=Object(i.b)(),o=Object(r.useState)(e.like),s=Object(I.a)(o,2),a=s[0],u=s[1],j=Object(r.useState)(!1),h=Object(I.a)(j,2),l=h[0],d=h[1],p=Object(i.c)((function(t){return t.authentification.isAuthenticated})),b=Object(i.c)((function(t){return t.authentification.user})),f=Object(i.c)((function(t){return t.authentification.token})),O=function(){var t={like:a};fetch("https://my-pasteque-space.herokuapp.com/posts/".concat(e.id),{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(f)},body:JSON.stringify(t)}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){n(function(t){return{type:k,toEditPost:t}}(t))})).catch((function(t){console.log(t)}))};Object(r.useEffect)((function(){a!==e.like&&O()}),[a]);var m=function(t){fetch("https://my-pasteque-space.herokuapp.com/posts/".concat(t.id),{method:"delete",headers:{Authorization:"Bearer ".concat(f)}}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){n(function(t){return{type:y,toDeletePost:t}}(t))})).catch((function(t){alert(t)}))};return Object(c.jsx)(F.a,{className:"col-lg-3",children:Object(c.jsxs)(F.a.Body,{children:[Object(c.jsx)(F.a.Text,{children:e.text}),p&&Object(c.jsxs)(F.a.Subtitle,{className:"mb-2 text-muted",children:[e.like," likes"]}),e.user&&p&&Object(c.jsx)(F.a.Link,{href:"/user/".concat(e.user.id),children:e.user.username}),e.user&&p&&e.user.id===b.id&&Object(c.jsx)(L.a,{type:"submit",onClick:function(){return m(e)},children:"Supprimer"}),!l&&Object(c.jsx)(L.a,{type:"submit",variant:"success",onClick:function(){return u(a+1),void d(!0)},children:"\ud83d\udc4d"}),l&&Object(c.jsx)(L.a,{type:"submit",variant:"danger",onClick:function(){return u(a-1),void d(!1)},children:"\ud83d\udc4e"})]})})},U=function(){var t=Object(i.c)((function(t){return t.posts.posts})),e=Object(i.b)();return Object(r.useEffect)((function(){fetch("https://my-pasteque-space.herokuapp.com/posts").then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){e(function(t){return{type:g,posts:t}}(t))})).catch((function(t){alert(t)}))}),[e]),Object(c.jsxs)("div",{children:[Object(c.jsx)("h2",{children:"Voici les posts :"}),Object(c.jsx)("div",{className:"d-flex",style:{flexWrap:"wrap"},children:t.sort((function(t,e){return new Date(e.created_at)-new Date(t.created_at)})).map((function(t){return Object(c.jsx)(J,{post:t},t.id)}))})]})},G=n(63),V=function(){var t=Object(i.c)((function(t){return t.authentification.isAuthenticated})),e=Object(i.c)((function(t){return t.posts.postsCount})),n=Object(i.b)(),o=Object(i.c)((function(t){return t.authentification.token})),s=function(){fetch("https://my-pasteque-space.herokuapp.com/posts/count",{method:"get",headers:{Authorization:"Bearer ".concat(o)}}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){n(function(t){return{type:S,postsCount:t}}(t))})).catch((function(t){alert(t)}))};return Object(r.useEffect)((function(){t&&s()}),[t]),Object(c.jsxs)("div",{children:[Object(c.jsxs)(G.a,{children:[Object(c.jsx)("h1",{children:"Bienvenue sur My Social Network"}),Object(c.jsx)("p",{children:"Ce site est un entra\xeenement \xe0 Redux et React. Nous utilisons l'authentification et le routing pour cr\xe9er un petit r\xe9seau social."}),e&&Object(c.jsxs)("small",{children:["Il y a actuellement ",e," messages sur notre r\xe9seau social ! \ud83d\ude32"]})]}),Object(c.jsx)(R,{}),Object(c.jsx)(U,{})]})},W=function(){var t=Object(i.c)((function(t){return t.authentification.isAuthenticated})),e=Object(r.useState)(""),n=Object(I.a)(e,2),o=n[0],s=n[1],a=Object(r.useState)(""),u=Object(I.a)(a,2),j=u[0],h=u[1],l=Object(i.b)(),d=Object(_.g)();Object(r.useEffect)((function(){t&&d.push("/")}),[t,d]);return Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:"Se connecter"}),Object(c.jsxs)("form",{onSubmit:function(t){t.preventDefault();var e={identifier:o,password:j};fetch("https://my-pasteque-space.herokuapp.com/auth/local",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){l(D(t)),d.push("/")})).catch((function(t){l(B()),alert("Erreur avec la combinaison Identifiant / Mot de passe")}))},children:[Object(c.jsxs)("div",{className:"form-group",children:[Object(c.jsx)("label",{htmlFor:"identifier",children:"Pseudo ou email"}),Object(c.jsx)("input",{type:"text",className:"form-control",id:"pseudo",placeholder:"Entrez votre pseudo ou votre adresse mail",value:o,onChange:function(t){return s(t.target.value)}})]}),Object(c.jsxs)("div",{className:"form-group",children:[Object(c.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(c.jsx)("input",{type:"password",className:"form-control",id:"password",placeholder:"Entrez votre mot de passe",value:j,onChange:function(t){return h(t.target.value)}})]}),Object(c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Se connecter"})]})]})},X=function(){var t=Object(i.c)((function(t){return t.authentification.user})),e=Object(i.c)((function(t){return t.authentification.token})),n=Object(r.useState)(""),o=Object(I.a)(n,2),s=o[0],a=o[1],u=Object(r.useState)(""),j=Object(I.a)(u,2),h=j[0],l=j[1],d=Object(r.useState)([]),p=Object(I.a)(d,2),b=p[0],f=p[1];return Object(r.useEffect)((function(){fetch("https://my-pasteque-space.herokuapp.com/posts?user.id=".concat(t.id),{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){f(t)})).catch((function(t){alert(t)}))}),[e,t.id]),Object(c.jsxs)("section",{children:[Object(c.jsxs)("h1",{children:["Bienvenue sur votre profil ",t.username," !"]}),Object(c.jsx)("p",{children:t.description}),Object(c.jsxs)("form",{onSubmit:function(n){n.preventDefault();var c={username:s,description:h};fetch("https://my-pasteque-space.herokuapp.com/users/".concat(t.id),{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(c)}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){a(s),l(h),window.location.reload()})).catch((function(t){alert(t)}))},children:[Object(c.jsxs)("div",{className:"form-group",children:[Object(c.jsx)("label",{htmlFor:"identifier",children:"Modifier mon pseudo"}),Object(c.jsx)("input",{type:"text",className:"form-control",id:"pseudo",placeholder:"Nouveau pseudo",value:s||t.username,onChange:function(t){return a(t.target.value)}})]}),Object(c.jsxs)("div",{className:"form-group",children:[Object(c.jsx)("label",{htmlFor:"password",children:"Modifier ma description"}),Object(c.jsx)("input",{type:"text",className:"form-control",id:"description",placeholder:"Nouvelle description",value:h||t.description,onChange:function(t){return l(t.target.value)}})]}),Object(c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"Modifier mes informations"})]}),Object(c.jsx)("div",{className:"d-flex",style:{flexWrap:"wrap"},children:b.sort((function(t,e){return new Date(e.created_at)-new Date(t.created_at)})).map((function(t){return Object(c.jsx)(J,{post:t},t.id)}))})]})},H=function(){var t=Object(i.c)((function(t){return t.authentification.isAuthenticated})),e=Object(r.useState)(""),n=Object(I.a)(e,2),o=n[0],s=n[1],a=Object(r.useState)(""),u=Object(I.a)(a,2),j=u[0],h=u[1],l=Object(r.useState)(""),d=Object(I.a)(l,2),p=d[0],b=d[1],f=Object(i.b)(),O=Object(_.g)();Object(r.useEffect)((function(){t&&O.push("/")}),[t,O]);return Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{children:"Register"}),Object(c.jsxs)("form",{onSubmit:function(t){t.preventDefault();var e={username:o,email:j,password:p};fetch("https://my-pasteque-space.herokuapp.com/auth/local/register",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){f(D(t)),O.replace("/")})).catch((function(t){f(B()),alert(t)}))},children:[Object(c.jsxs)("div",{className:"form-group",children:[Object(c.jsx)("label",{htmlFor:"pseudo",children:"Pseudo"}),Object(c.jsx)("input",{type:"text",className:"form-control",id:"pseudo",placeholder:"Choisissez votre pseudo",value:o,onChange:function(t){return s(t.target.value)}})]}),Object(c.jsxs)("div",{className:"form-group",children:[Object(c.jsx)("label",{htmlFor:"mail",children:"Adresse Email"}),Object(c.jsx)("input",{type:"email",className:"form-control",id:"mail",placeholder:"Entrez votre adresse email",value:j,onChange:function(t){return h(t.target.value)}})]}),Object(c.jsxs)("div",{className:"form-group",children:[Object(c.jsx)("label",{htmlFor:"password",children:"Mot de passe"}),Object(c.jsx)("input",{type:"password",className:"form-control",id:"password",placeholder:"Entrez votre mot de passe",value:p,onChange:function(t){return b(t.target.value)}})]}),Object(c.jsx)("button",{type:"submit",className:"btn btn-primary",children:"M'inscrire"})]})]})},K=function(){var t=Object(_.h)().userId,e=O.a.get("token"),n=Object(r.useState)({}),o=Object(I.a)(n,2),s=o[0],a=o[1],i=Object(r.useState)([]),u=Object(I.a)(i,2),j=u[0],h=u[1];return Object(r.useEffect)((function(){fetch("https://my-pasteque-space.herokuapp.com/users/".concat(t),{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){a(t)})).catch((function(t){alert(t)})),fetch("https://my-pasteque-space.herokuapp.com/posts?user.id=".concat(t),{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){h(t)})).catch((function(t){alert(t)}))}),[e,t]),Object(c.jsxs)("section",{children:[Object(c.jsxs)("h1",{children:["Bienvenue sur le profil de ",s.username]}),Object(c.jsx)("p",{children:s.description}),Object(c.jsx)("div",{className:"d-flex",style:{flexWrap:"wrap"},children:j.sort((function(t,e){return new Date(e.created_at)-new Date(t.created_at)})).map((function(t){return Object(c.jsx)(J,{post:t},t.id)}))})]})},Q=function(){var t=Object(i.c)((function(t){return t.authentification.isAuthenticated})),e=Object(i.b)();Object(r.useEffect)((function(){O.a.get("token")&&fetch("https://my-pasteque-space.herokuapp.com/users/me",{method:"get",headers:{Authorization:"Bearer ".concat(O.a.get("token"))}}).then((function(t){if(!t.ok)throw Error(t.statusText);return t})).then((function(t){return t.json()})).then((function(t){e(function(t){return{type:p,user:t,token:O.a.get("token")}}(t))})).catch((function(t){console.log(t)}))}),[e]);var n=function(e){var n=e.component,r=Object(C.a)(e,["component"]);return Object(c.jsx)(_.b,Object(h.a)(Object(h.a)({},r),{},{render:function(e){return t?Object(c.jsx)(n,Object(h.a)({},e)):Object(c.jsx)(_.a,{to:{pathname:"/login"}})}}))};return Object(c.jsx)(A.a,{children:Object(c.jsxs)("div",{children:[Object(c.jsx)(q,{}),Object(c.jsxs)(_.d,{children:[Object(c.jsx)(_.b,{path:"/",exact:!0,component:V}),Object(c.jsx)(_.b,{path:"/register",component:H}),Object(c.jsx)(_.b,{path:"/login",component:W}),Object(c.jsx)(n,{path:"/profile",component:X}),Object(c.jsx)(_.b,{path:"/user/:userId",component:K})]})]})})};n(59);a.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(i.a,{store:T,children:Object(c.jsx)(Q,{})})}),document.getElementById("root"))}},[[60,1,2]]]);
//# sourceMappingURL=main.0e1608fc.chunk.js.map